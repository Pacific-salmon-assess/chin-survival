---
title: "Stock-Specific CJS Model Summary"
output: html_document
date: "2024-10-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Variability in CJS Model Structure Among Stocks

CJS models have to be fit to stocks with coherent migration routes because the number of parameters is determined by the number of discrete stages of the migration that can be represented by detections on distinct receivers. In other words, a detection on a given receiver often means something different (in terms of en route survival) for different stocks. 

Given these issues we focus the CJS analyses on six stocks with a relatively large number of tags (n > 10) and multiple migration stages with reasonable detection probability (e.g. Washington coastal stocks excluded because very low in-river detection probability). The exact specifications of the CJS model varied among stocks, but they shared the following components:

1. detection probability $p$ and survival $\phi$ are estimated using a non-centered parameterization where a parameter, $\alpha_p$ or $\alpha_{\phi}$, represents the overall mean for the stock
2. $p$ is assumed to vary among migration stages $s$ (i.e., arrays) and years $t$ due to differences in receiver density; i.e. $p_{s,t}$ is represented as the sum of $\alpha_p$ and fixed effect $\alpha_{p,s,t}$
3. $\phi$ is assumed to vary among stages $s$, but also to have a year specific random offset representing annual deviations; deviations are modeled to covary across $s$ within $y$ to account for shared annual effects; i.e. $\phi_{s,t}$ is represented as the sum of $\alpha_{\phi}$ and fixed effect $\alpha_{\phi,s}$ and random intercept $\alpha_{\phi,s,t}$
4. unless the terminal value $p_{term}$ is fixed (i.e. assumed to be high), $p_{term}$ and $\phi_{term}$ cannot be estimated independently and instead their product $\beta$ is calculated

Receiver arrays were grouped into discrete migration stages that differed among stocks (Figure \@ref(fig:receiver-map2)). The mark-recapture matrix used as response data in each stock's CJS model had dimensions $n_{row}=n_{tags}$ and $n_{col}=n_{stage}$.

```{r receiver-map2, echo=FALSE, fig.width=6, fig.height=7, fig.cap = "Receiver arrays grouped by stock-specific migration stage. Darker (lighter) colours represent locations earlier (later) in a stock's migration. Freshwater receivers are only shown in locations where a stock was likely to encounter them. Stocks with insufficient sample sizes to fit CJS models are not shown."}
map2 <- readRDS(here::here("figs", "array_map.rds"))
map2
```

Each stock's model also had the following unique characteristics:

* California
  + Default
  + No hierarchical structure due to small sample size
  + No fixed $p_{term}$ due to uneven coverage and uncertain migratory pathways
* Fraser River
  + Hierarchical structure with $\alpha_{pop}$ representing among population deviations in survival; $p$ shared given similar migration timing; 3 stock groups including Fraser yearling, Summer $4_1$ and Fall
  + $p_{term}$ fixed at 0.95 given high detection probability (2-3 VR2 arrays) for lower river
  + Upstream detections ignored (recaptures only)
* Lower Columbia
  + Default
  + No hierarchical structure due to mismatch between GSI and likely migration destination (e.g. Spring Creek identified as Abernathy River)
  + Final detection probability will vary from low (most populations) to high (Spring Creek); estimate det prob at Bonneville but focus on survival to lower river
* South Puget
  + Default
  + No hierarchical structure due to mismatch between GSI and likely migration destination (e.g. lots of straying from Soos Creek and Green River); this is also why no separation of central and south sound (and might be biased low if straying to north sound is significant)
  + Final detection probability will be low in-river so focus on survival to Puget Sound array
* Upper Columbia
  + Either a) fix Bonneville and Upriver detection probabilities to be the same or b) at a high value 
  + No hierarchical structure due to mismatch between GSI and likely migration destination and relatively unbalanced among stocks
* WCVI
  + Default
  + Substantial variability on in-river coverage among years (should be accounted for by model)
